# Проект: Telegram RPG Bot "Тени Подземелий"

## Структура проекта
```
C:\Users\Faiz\Desktop\БОТ\
├── bot.py                 # Главный файл, регистрация обработчиков
├── config.py              # Конфигурация (BOT_TOKEN)
├── data/
│   ├── __init__.py        # Экспорт констант
│   ├── classes.py         # CLASSES - классы персонажей
│   ├── dungeons.py        # DUNGEONS, ENEMIES - подземелья и враги
│   ├── items.py           # ITEMS, EPIC_SETS, LEGENDARY_WEAPONS, SLOT_NAMES
│   ├── quests.py          # QUESTS, ACHIEVEMENTS, DAILY_REWARDS
│   └── tavern.py          # TAVERN_FOOD, MERCENARIES, BLACKSMITH_UPGRADES,
│                          # CRAFT_RECIPES, ALCHEMY_RECIPES, LEGENDARY_CRAFT_RECIPES, SOCKETS
├── handlers/
│   ├── menu.py            # start, main_menu, show_profile, show_skills, регистрация
│   ├── combat.py          # Боевая система, атаки, скиллы, зелья
│   ├── dungeon.py         # Подземелья, этажи, боссы
│   ├── tavern.py          # Таверна, кузнец, алхимик, квесты, сокеты
│   ├── inventory.py       # Инвентарь, экипировка, магазин, слоты зелий
│   ├── misc.py            # Достижения, ежедневки, отдых, титулы
│   └── arena.py           # PvP арена - поиск соперника, бой, рейтинг
├── models/
│   ├── player.py          # Класс Player - данные игрока
│   ├── fight.py           # Класс Fight - состояние боя (PvE)
│   └── pvp_fight.py       # Класс PvPFight - состояние PvP боя
├── utils/
│   ├── storage.py         # Загрузка/сохранение данных (players_data.json)
│   ├── helpers.py         # Вспомогательные функции, UI боя, safe_edit_message
│   └── avatar.py          # Генерация пиксельных аватаров персонажей
├── assets/
│   └── base/              # Спрайты персонажей (warrior.png, mage.png, archer.png, paladin.png)
└── PNG/                   # CraftPix спрайты с анимациями (Knight, Mage, Rogue)
```

## Основные системы

### Классы персонажей
- Воин, Маг, Лучник (Разбойник), Паладин
- Каждый класс имеет уникальный пиксельный спрайт и цвет фона

### Аватары персонажей
- Пиксельные спрайты (128x128 → масштаб 2x)
- Градиентный фон по цвету класса (воин-красный, маг-синий, лучник-зелёный, паладин-жёлтый)
- Отображаются в главном меню и профиле
- Система слоёв для экипировки (пока не используется)

### Подземелья
- forest (Лес) → mines (Шахты) → crypt (Крипта) → abyss (Бездна) → chaos (Хаос)
- Каждое имеет врагов, босса, множители exp/gold

### Боевая система
- Атака, блок, скиллы (зависят от класса и уровня)
- 2 слота зелий (настраиваемые в инвентаре)
- Бафы от еды, наёмники
- Эффекты: яд, ожог, вампиризм, оглушение

### Экипировка
- Слоты: weapon, helmet, shoulders, chest, belt, gloves, leggings, boots, ring, necklace
- Редкости: common, uncommon, rare, epic, legendary
- Эпические сеты с бонусами
- **Сокеты** - вставляются в экипировку (10k-100k золота)

### Система сокетов
- Тир 1 (10,000 золота): +3 урон/защита, +20 HP, +15 мана
- Тир 2 (30,000 золота): +8 урон/защита, +50 HP, +40 мана
- Тир 3 (60,000 золота): +15 урон/защита, +100 HP, +80 мана
- Тир 4 (100,000 золота): +25 урон/защита + доп. бонусы (крит, уклонение, вампиризм)
- Меню: Таверна → Кузнец → Сокеты

### Дроп чешуи дракона (с боссов)
| Подземелье | Шанс |
|------------|------|
| Лес | 5% |
| Шахты | 10% |
| Крипта | 15% |
| Бездна | 25% |
| Хаос | 50% |
- Падает 1-3 шт. за босса

### Квесты
- Сюжетные (story_forest, story_mines, story_crypt, story_abyss, story_chaos) - убить босса
- Ежедневные/еженедельные
- Легендарные (получить чертёж легендарного оружия)

### Крафт
- Кузнец: обычные рецепты, редкие, легендарные
- Алхимик: зелья HP, маны, эликсиры

## Модель Player (основные поля)
```python
user_id, name, player_class, level, exp, exp_to_level
hp, mana, gold
inventory = {}           # item_id -> количество
equipment = {}           # slot -> item_id
stats = {}               # kills, boss_kills, deaths, floors, etc.
quest_progress = {}      # quest_id -> progress
completed_quests = []    # список завершённых квестов
titles = [], title       # титулы
achievements = []        # достижения
food_buffs = {}          # бафы от еды
mercenary = None         # наёмник
potion_slots = {"slot_1": "hp_potion_small", "slot_2": "mana_potion_small"}
item_sockets = {}        # slot -> socket_id
pvp_rating = 1000        # PvP рейтинг
pvp_wins = 0, pvp_losses = 0, pvp_win_streak = 0
```

## GitHub
Репозиторий: https://github.com/Hapypopka/telegram-rpg-bot.git

### PvP Арена
- Реал-тайм PvP бои между игроками
- Матчмейкинг по рейтингу (±300)
- Рейтинговая система (стартовый рейтинг 1000)
- Звания: Ученик → Новичок → Боец → Мастер → Грандмастер → Легенда
- Награды за победу: золото + рейтинг + бонус за серию побед
- Лидерборд топ-10 игроков
- Доступно с 3 уровня

### Эпические сеты
- Бонусы за 2/4/6/8 предметов
- Titan: HP, урон, защита, вампиризм
- Archmage: мана, урон, снижение стоимости скиллов
- Phantom: крит, уклонение, множитель крита

## Утилиты

### safe_edit_message (utils/helpers.py)
Безопасное редактирование сообщений - обрабатывает ситуацию когда нужно перейти от фото к тексту (удаляет фото и отправляет новое сообщение).

### generate_profile_image (utils/avatar.py)
Генерирует пиксельный аватар персонажа с градиентным фоном.

## История изменений
1. Исправлены сюжетные квесты - теперь отслеживаются при убийстве боссов
2. Фарм золота уменьшен в 10 раз
3. Добавлена система сокетов с 4 уровнями
4. Добавлены настраиваемые слоты зелий для боя
5. Исправлен порядок обработчиков (smith_sockets до общего ^smith_)
6. Добавлено отображение суммарных бонусов от сокетов в меню
7. Добавлены бонусы эпических сетов за 6 и 8 предметов
8. Добавлена PvP арена с реал-тайм боями и рейтинговой системой
9. Добавлена система аватаров с пиксельными спрайтами (CraftPix)
10. Аватар отображается в главном меню и профиле
11. Добавлена safe_edit_message для корректного перехода фото→текст
